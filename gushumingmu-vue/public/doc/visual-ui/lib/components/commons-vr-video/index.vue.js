"use strict";var M=Object.defineProperty;var w=(n,e,s)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var v=(n,e,s)=>w(n,typeof e!="symbol"?e+"":e,s);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue");require("@babylonjs/loaders/glTF");const m=require("lodash"),i=require("@babylonjs/core"),_={class:"zerov-widget"},S=o.defineComponent({name:"zv-commons-vr-video"}),P=o.defineComponent({...S,props:{basicOption:{}},setup(n){const e=n,s=u=>{const a=o.ref(),h=o.ref();class b{constructor(r,t){v(this,"scene");v(this,"engine");this.canvas=r,this.option=t,this.engine=new i.Engine(this.canvas,!0,{},!1),h.value=!0,window.addEventListener("resize",()=>{this.engine.resize()}),this.scene=this.createScene()}createScene(){const r=new i.Scene(this.engine),t=new i.ArcRotateCamera("Camera",-Math.PI/2,Math.PI/2,5,i.Vector3.Zero(),r);t.attachControl(a.value,!0),t.useAutoRotationBehavior=this.option.cameraAutoRotation,t.inputs.attached.mousewheel.detachControl();const c=new i.VideoDome("",this.option.url,{resolution:this.option.resolution||32,clickToPlay:this.option.clickToPlay,autoPlay:this.option.autoPlay,loop:this.option.loop,poster:this.option.poster,useDirectMapping:!1,halfDomeMode:this.option.halfDomeMode},r);if(this.option.isReversal&&(t.angularSensibilityX=-t.angularSensibilityX,t.angularSensibilityY=-t.angularSensibilityY),this.option.videoMode&&(c.videoMode=i.PhotoDome[this.option.videoMode]),c.fovMultiplier=this.option.defaultFov||1,this.option.isScale){let l=c.fovMultiplier;r.onPointerObservable.add(y=>{c!==void 0&&(l+=y.event.wheelDelta*-5e-4,l<0&&(l=0),l>2&&(l=2),c.fovMultiplier=l)},i.PointerEventTypes.POINTERWHEEL)}return setTimeout(()=>{h.value=!1},200),r}run(){return this.engine.runRenderLoop(()=>{this.scene.render()}),this}dispose(){this.scene&&this.engine&&(this.scene.dispose(),this.engine.dispose())}}const p=o.ref();return o.onMounted(()=>{p.value=new b(a.value,u).run()}),o.onBeforeUnmount(()=>{p.value&&p.value.dispose()}),{canvasRef:a,babylon:p,Babylon:b,loadingStatus:h}},{canvasRef:f,babylon:d,Babylon:g}=s(e.basicOption);return o.watch(()=>m.cloneDeep(e.basicOption),(u,a)=>{!m.isEqual(u,a)&&d.value&&(d.value.dispose(),d.value=new g(f.value,e.basicOption).run())},{deep:!0}),(u,a)=>(o.openBlock(),o.createElementBlock("div",_,[o.createElementVNode("canvas",{ref_key:"canvasRef",ref:f,class:"widget"},null,512)]))}});exports.default=P;
