"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue"),p=require("lodash"),u=require("nanoid"),I=require("../../commons/plugins/datasource/index.js"),_=require("../../commons/utils/json2css.js"),l=require("../../commons/plugins/event/index.js"),C=["onClick"],q=["src"],z=o.defineComponent({name:"zv-commons-loop-iterator"}),G=o.defineComponent({...z,props:{basicOption:{},sources:{},useEvents:{},uuid:{}},emits:["on-change"],setup(s,{expose:h,emit:m}){const n=s,x=()=>{const r=o.ref(),a=o.ref([]);return{init:()=>{I.SHJDatasourceV2.parse({tId:n.uuid,sources:n.sources,callback:e=>{try{r.value=u.nanoid(),e&&e.data?a.value=p.cloneDeep(e.data[0].data):a.value=[]}catch{l.SHJParseEvent.parseEvents(n.useEvents,"dataListener",null),r.value=u.nanoid(),a.value=[]}}})},key:r,loopData:a,renderItemStyle:e=>({gridTemplateColumns:`repeat(${e.columns}, 1fr)`,alignItems:e.alignItems,rowGap:e.rowGap+"px",columnGap:e.columnGap+"px",borderWidth:e.border.width+"px",borderColor:e.border.color,borderStyle:e.border.style,background:e.background.type==="color"?e.background.color:`no-repeat center/100% url(${e.background.image})`,boxShadow:e.shadow.x+"px "+e.shadow.y+"px "+e.shadow.blur+"px "+e.shadow.diffus+"px "+e.shadow.color}),renderImageStyle:e=>e?{width:e.width+"px",height:e.height+"px",objectFit:e.objectFit,borderWidth:e.border.width+"px",borderColor:e.border.color,borderStyle:e.border.style,boxShadow:e.shadow.x+"px "+e.shadow.y+"px "+e.shadow.blur+"px "+e.shadow.diffus+"px "+e.shadow.color,padding:e.padding[0]+"px "+e.padding[1]+"px "+e.padding[2]+"px "+e.padding[3]+"px"}:{},renderTextStyle:e=>(_.autoInstallFont(e.font),e?{width:e.width+"px",height:e.height+"px",color:e.color,fontSize:e.size+"px",fontFamily:e.font,fontStyle:e.style,boxShadow:e.shadow.x+"px "+e.shadow.y+"px "+e.shadow.blur+"px "+e.shadow.diffus+"px "+e.shadow.color,padding:e.padding[0]+"px "+e.padding[1]+"px "+e.padding[2]+"px "+e.padding[3]+"px"}:{}),renderLoopWrapStyle:e=>({overflow:e.overflow,gridTemplateColumns:`repeat(${e.columns}, 1fr)`,rowGap:e.rowGap+"px",columnGap:e.columnGap+"px",borderWidth:e.border.width+"px",borderColor:e.border.color,borderStyle:e.border.style,background:e.background.type==="color"?e.background.color:`no-repeat center/100% url(${e.background.image})`,boxShadow:e.shadow.x+"px "+e.shadow.y+"px "+e.shadow.blur+"px "+e.shadow.diffus+"px "+e.shadow.color})}},{init:d,key:b,loopData:g,renderImageStyle:w,renderTextStyle:f,renderItemStyle:S,renderLoopWrapStyle:k}=x(),v=m,E=r=>{v("on-change",r),l.SHJParseEvent.parseEvents(n.useEvents,"on-change",{data:r})};return o.onMounted(()=>d()),o.watch(()=>n.basicOption,(r,a)=>{p.isEqual(r,a)||d()},{deep:!0}),o.watch(()=>n.sources,(r,a)=>{p.isEqual(r,a)||d()},{deep:!0}),h({refresh:()=>d(),refreshView:()=>d(),refreshData:()=>d()}),(r,a)=>(o.openBlock(),o.createElementBlock("div",{key:o.unref(b),class:"zerov-widget loop-iterator-wrap",style:o.normalizeStyle(o.unref(k)(n.basicOption))},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(o.unref(g),(i,c)=>(o.openBlock(),o.createElementBlock("div",{key:c,class:"loop-iterator-item",style:o.normalizeStyle(o.unref(S)(n.basicOption.itemStyle)),onClick:o.withModifiers(t=>E(i),["stop"])},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(n.basicOption.itemContent,(t,B)=>(o.openBlock(),o.createElementBlock("div",{key:t.id},[t.type==="image"?(o.openBlock(),o.createElementBlock("div",{key:0,class:"loop-iterator-item-image",style:o.normalizeStyle(o.unref(w)(t.style))},[o.createElementVNode("img",{src:i[t.field],alt:"图片"},null,8,q)],4)):(o.openBlock(),o.createElementBlock("div",{key:1,style:o.normalizeStyle(o.unref(f)(t.style))},o.toDisplayString(i[t.field]),5))]))),128))],12,C))),128))],4))}});exports.default=G;
