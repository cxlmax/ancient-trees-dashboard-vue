"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue"),i=require("../../commons/plugins/event/index.js"),u={class:"iframe-webscoket"},E=["src"],w=o.defineComponent({name:"zv-scene-ue-iframe"}),f=o.defineComponent({...w,props:{basicOption:{},sources:{},useEvents:{},uuid:{},isPreview:{type:Boolean}},emits:["ue-scoket-on-message"],setup(l,{emit:d}){const s=l,S=d;return i.SHJParseEvent.parseEvents(s.useEvents,"on-page-loaded",null),(t=>{let n=0,r;const a=()=>{window.SHJSceneUEIframeWebscoket&&(window.SHJSceneUEIframeWebscoket.onclose=null,window.SHJSceneUEIframeWebscoket.close()),window.SHJSceneUEIframeWebscoket=new WebSocket(t.webSocketUrl),window.SHJSceneUEIframeWebscoket.onmessage=c=>{try{const e=JSON.parse(c.data);if(e.type==="ping")return;if(!e.data)throw new Error("数据格式异常");S("ue-scoket-on-message",e.data),i.SHJParseEvent.parseEvents(s.useEvents,"ue-scoket-on-message",e.data)}catch{}},window.SHJSceneUEIframeWebscoket.onopen=()=>{n=0,clearTimeout(r)},window.SHJSceneUEIframeWebscoket.onerror=()=>{},window.SHJSceneUEIframeWebscoket.onclose=c=>{const e=3e3*Math.pow(2,n);r=setTimeout(()=>{n<1/0&&(n++,a())},e)}};o.onMounted(()=>{if(t.webSocketUrl)try{a()}catch{}}),o.onBeforeUnmount(()=>{window.SHJSceneUEIframeWebscoket&&window.SHJSceneUEIframeWebscoket.close()})})(s.basicOption),(t,m)=>(o.openBlock(),o.createElementBlock("div",u,[o.createElementVNode("iframe",{src:t.basicOption.iframeUrl,sandbox:"allow-scripts allow-same-origin",style:{width:"100%",height:"100%",border:"0"}},null,8,E)]))}});exports.default=f;
