"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),G=require("./resources/zv-vr-select.svg.js"),y=require("./resources/zv-return.svg.js"),W=require("./resources/zv-add.svg.js"),Y=require("./resources/zv-reduce.svg.js"),F=require("./resources/zv-play.svg.js"),U=require("./resources/zv-pause.svg.js"),$=require("./resources/zv-refresh.svg.js"),_=require("hls.js"),b=require("lodash"),p=require("../../commons/plugins/event/index.js"),i=m=>(e.pushScopeId("data-v-d1dd2ed8"),m=m(),e.popScopeId(),m),Z={class:"vr-scene-wrap"},K={id:"panorama",class:"vr-scene"},Q={id:"panorama-video-wrap",class:"vr-scene-main"},X={key:1,class:"vr-scene-controls"},x=i(()=>e.createElementVNode("img",{src:G.default,alt:""},null,-1)),ee=i(()=>e.createElementVNode("img",{src:y.default,alt:""},null,-1)),oe=[ee],te=i(()=>e.createElementVNode("img",{src:y.default,alt:""},null,-1)),ne=[te],se=i(()=>e.createElementVNode("img",{src:y.default,alt:""},null,-1)),ce=[se],ae=i(()=>e.createElementVNode("img",{src:y.default,alt:""},null,-1)),ie=[ae],le=i(()=>e.createElementVNode("img",{src:W.default,alt:""},null,-1)),re=[le],de=i(()=>e.createElementVNode("img",{src:Y.default,alt:""},null,-1)),ue=[de],ve=i(()=>e.createElementVNode("img",{src:F.default,alt:""},null,-1)),pe=[ve],me=i(()=>e.createElementVNode("img",{src:U.default,alt:""},null,-1)),we=[me],fe=i(()=>e.createElementVNode("img",{src:$.default,alt:""},null,-1)),Se=[fe],Ve={class:"scene-list"},he=["onClick"],be=["src"],ye={class:"label"},ke=["autoplay","loop","volume"],ge=["src"],Ee={key:3,class:"mouse-tip"},_e=e.createStaticVNode('<div class="icon-wrap" data-v-d1dd2ed8><div class="left" data-v-d1dd2ed8><i class="iconfont zv-drop-down" data-v-d1dd2ed8></i></div><i class="iconfont zv-mouse" data-v-d1dd2ed8></i><div class="right" data-v-d1dd2ed8><i class="iconfont zv-drop-down" data-v-d1dd2ed8></i></div></div><p class="title" data-v-d1dd2ed8>左右拖动   更多精彩</p>',2),He=[_e],Oe=e.defineComponent({name:"zv-scene-vr"}),Je=e.defineComponent({...Oe,props:{basicOption:{},sources:{},useEvents:{},uuid:{},isPreview:{type:Boolean},disableDrag:{type:Boolean}},emits:["on-scene-loaded","on-scene-scenechange","on-scene-zooming","on-scene-hotClick"],setup(m,{emit:J}){const t=m,w=J;p.SHJParseEvent.parseEvents(t.useEvents,"on-page-loaded",null);const l=e.ref(),r=e.ref({src:"",autoplay:!0,loop:!0,volume:50}),u=e.ref(null),B=e.ref(t.basicOption.default.firstScene),v=e.ref(B.value),n=e.computed(()=>{try{return t.basicOption.scenes[v.value]}catch{return null}}),H={bylineLabel:"来自 %s",noPanoramaError:"未指定全景图像。",fileAccessError:"The file %s could not be accessed.",malformedURLError:"全景URL无法访问。",iOS8WebGLError:"Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).",genericWebGLError:"您的浏览器没有显示此全景图所需的WebGL支持。",textureSizeError:"This panorama is too big for your device! It's %spx wide, but your device only supports images up to %spx wide. Try another device. (If you're the author, try scaling down the image.)",unknownError:"未知错误。检查开发人员控制台。"},C=()=>{const o=t.basicOption;window.SHJSceneVrViewer=window.pannellum.viewer("panorama",{...o,default:Object.assign(b.cloneDeep(o.default),{firstScene:v.value}),strings:H})},N=()=>{const o=()=>{const a=document.getElementById("panorama-video-wrap");a.innerHTML=`
            <video
                id="panorama-video"
                autoplay
                class="video-js vjs-default-skin vr-scene vjs-big-play-centered"
                preload="none"
                style="width:100%;height:100%;"
                crossorigin="anonymous"
            >
            </video>
        `};u.value&&(u.value.dispose(),u.value=null,o()),u.value||o();const s=document.getElementById("panorama-video"),c=t.basicOption;if(u.value=window.videojs(s,{loop:!0,autoplay:!0,plugins:{pannellum:{...t.basicOption,default:Object.assign(b.cloneDeep(c.default),{firstScene:v.value}),strings:H}}}),window.SHJSceneVrViewer=u.value.pnlmViewer,n.value.sceneType==="video"&&(s.src=n.value.panorama),n.value.sceneType==="hls")if(_.isSupported()){const a=new _;a.loadSource(n.value.panorama),a.attachMedia(s),a.on(_.Events.MANIFEST_PARSED,()=>{s.play()})}else s.canPlayType("application/vnd.apple.mpegurl")&&(s.src=n.value.panorama)},k=()=>{if(window.pannellum&&t.basicOption){window.SHJSceneVrViewer&&(window.SHJSceneVrViewer.destroy(),window.SHJSceneVrViewer=null),n.value.sceneType==="image"?C():N();try{t.basicOption.scenes[window.SHJSceneVrViewer.getScene()]&&(r.value=t.basicOption.default.audio,l.value&&r.value&&(window.SHJSceneVrViewer.audio=l,l.value.src=r.value.src,setTimeout(()=>{l.value&&(S.value=l.value.paused)},500)))}catch{}window.SHJSceneVrViewer.on("load",()=>{w("on-scene-loaded",n.value),p.SHJParseEvent.parseEvents(t.useEvents,"on-scene-loaded",n.value)}),!t.isPreview||t.basicOption.default.autoRotate===0?window.SHJSceneVrViewer.stopAutoRotate():window.SHJSceneVrViewer.startAutoRotate();try{window.SHJSceneVrViewer&&async function(){for(const o in t.basicOption.scenes)Object.prototype.hasOwnProperty.call(t.basicOption.scenes,o)&&t.basicOption.scenes[o].hotSpots.forEach(async c=>{await setTimeout(()=>{c.draggable=!t.isPreview&&!t.disableDrag,window.SHJSceneVrViewer.removeHotSpot(c.id,o),window.SHJSceneVrViewer.addHotSpot(c,o)},100)})}()}catch{}window.SHJSceneVrViewer.on("scenechange",o=>{const s=document.getElementsByTagName("video");if(b.isArray(s)&&s.length>0&&s.forEach(c=>{c&&c.pause()}),n.value){const c=n.value.sceneType;v.value=o;const a=n.value.sceneType;setTimeout(()=>{(a!=="image"||c!=="image"&&a==="image")&&k(),V.value=v.value,w("on-scene-scenechange",n.value),p.SHJParseEvent.parseEvents(t.useEvents,"on-scene-scenechange",n.value)}),t.isPreview?window.SHJSceneVrViewer.startAutoRotate():window.SHJSceneVrViewer.stopAutoRotate()}else v.value=t.basicOption.default.firstScene,e.nextTick(()=>{k(),w("on-scene-scenechange",n.value),p.SHJParseEvent.parseEvents(t.useEvents,"on-scene-scenechange",n.value)})}),window.SHJSceneVrViewer.on("zoomchange",b.debounce(o=>{w("on-scene-zooming",n.value),p.SHJParseEvent.parseEvents(t.useEvents,"on-scene-zooming",n.value)},300)),window.SHJSceneVrViewer.on("hot-click",o=>{w("on-scene-hotClick",o),p.SHJParseEvent.parseEvents(t.useEvents,"on-scene-hotClick",o)})}},V=e.ref(t.basicOption.default.firstScene),T=e.computed(()=>{const o=[];if(t.basicOption){const s=t.basicOption.scenes;for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const a=s[c];o.push({label:a.label,value:c,thumbnail:a.cover})}}return o.sort((s,c)=>{const a=parseInt(s.value.replace("scene","")),d=parseInt(c.value.replace("scene",""));return a-d})});e.watch(()=>t.basicOption.default,()=>{t.isPreview?window.SHJSceneVrViewer.startAutoRotate():window.SHJSceneVrViewer.stopAutoRotate()},{deep:!0});const P=o=>{window.SHJSceneVrViewer&&V.value!==o&&(V.value=o,window.SHJSceneVrViewer.isLoaded()&&(window.SHJSceneVrViewer.loadScene(o),t.isPreview?window.SHJSceneVrViewer.startAutoRotate():window.SHJSceneVrViewer.stopAutoRotate()))},g=e.ref(),f=e.ref(!0),R=()=>{f.value?g.value.style.bottom="-999px":g.value.style.bottom="80px",f.value=!f.value};e.onMounted(()=>{t.basicOption&&(t.basicOption.default.controls===void 0&&(t.basicOption.default.controls=n.value.controls),t.basicOption.default.audio===void 0&&(t.basicOption.default.audio=n.value.audio)),k(),M()});const z=()=>{window.SHJSceneVrViewer.setPitch(window.SHJSceneVrViewer.getPitch()+10)},A=()=>{window.SHJSceneVrViewer.setPitch(window.SHJSceneVrViewer.getPitch()-10)},D=()=>{window.SHJSceneVrViewer.setYaw(window.SHJSceneVrViewer.getYaw()-10)},L=()=>{window.SHJSceneVrViewer.setYaw(window.SHJSceneVrViewer.getYaw()+10)},I=()=>{window.SHJSceneVrViewer.setHfov(window.SHJSceneVrViewer.getHfov()-10)},j=()=>{window.SHJSceneVrViewer.setHfov(window.SHJSceneVrViewer.getHfov()+10)},S=e.ref(!1),O=o=>{l.value&&(o==="play"?(l.value.play(),S.value=!1):(l.value.pause(),S.value=!0))},q=()=>{window.SHJSceneVrViewer.startAutoRotate()};let E;const h=e.ref(!1),M=()=>{t.basicOption.default.controls?h.value=t.basicOption.default.controls.mouseTipShow:h.value=!0,E&&clearTimeout(E),E=setTimeout(()=>{h.value=!1},3500)};return(o,s)=>{const c=e.resolveComponent("el-tooltip"),a=e.resolveComponent("el-scrollbar");return e.openBlock(),e.createElementBlock("div",Z,[n.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.withDirectives(e.createElementVNode("div",K,null,512),[[e.vShow,n.value.sceneType==="image"]]),e.withDirectives(e.createElementVNode("div",Q,null,512),[[e.vShow,n.value.sceneType!=="image"]])],64)):e.createCommentVNode("",!0),o.basicOption.default.controls?(e.openBlock(),e.createElementBlock("div",X,[o.basicOption.default.controls.scene?(e.openBlock(),e.createElementBlock("div",{key:0,class:"btn-icon left",style:e.normalizeStyle({borderColor:f.value?"#ff7d00":"#ffffff3d"}),onClick:R},[e.createVNode(c,{content:"场景选择"},{default:e.withCtx(()=>[x]),_:1})],4)):e.createCommentVNode("",!0),o.basicOption.default.controls.left?(e.openBlock(),e.createElementBlock("div",{key:1,class:"btn-icon left",onClick:D},oe)):e.createCommentVNode("",!0),o.basicOption.default.controls.right?(e.openBlock(),e.createElementBlock("div",{key:2,class:"btn-icon right",onClick:L},ne)):e.createCommentVNode("",!0),o.basicOption.default.controls.top?(e.openBlock(),e.createElementBlock("div",{key:3,class:"btn-icon up",onClick:z},ce)):e.createCommentVNode("",!0),o.basicOption.default.controls.bottom?(e.openBlock(),e.createElementBlock("div",{key:4,class:"btn-icon down",onClick:A},ie)):e.createCommentVNode("",!0),o.basicOption.default.controls.magnify?(e.openBlock(),e.createElementBlock("div",{key:5,class:"btn-icon",onClick:I},re)):e.createCommentVNode("",!0),o.basicOption.default.controls.shrink?(e.openBlock(),e.createElementBlock("div",{key:6,class:"btn-icon",onClick:j},ue)):e.createCommentVNode("",!0),S.value&&r.value.src&&o.basicOption.default.audio?(e.openBlock(),e.createElementBlock("div",{key:7,class:"btn-icon",onClick:s[0]||(s[0]=d=>O("play"))},pe)):e.createCommentVNode("",!0),!S.value&&r.value.src&&o.basicOption.default.audio?(e.openBlock(),e.createElementBlock("div",{key:8,class:"btn-icon",onClick:s[1]||(s[1]=d=>O("pause"))},we)):e.createCommentVNode("",!0),o.basicOption.default.controls.rotate?(e.openBlock(),e.createElementBlock("div",{key:9,class:"btn-icon",onClick:q},Se)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),o.basicOption.default.controls?(e.openBlock(),e.createElementBlock("div",{key:2,ref_key:"sceneMenuRef",ref:g,class:"scene-menu",style:e.normalizeStyle({bottom:f.value&&o.basicOption.default.controls.scene?"80px":"-9999999999999px"})},[e.createVNode(a,null,{default:e.withCtx(()=>[e.createElementVNode("div",Ve,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(T.value,d=>(e.openBlock(),e.createElementBlock("div",{key:d.value,class:"scene-item",style:e.normalizeStyle({borderColor:V.value===d.value?"#ff7d00":"#fff"}),onClick:Be=>P(d.value)},[e.createElementVNode("img",{class:"thumbnail",src:d.thumbnail},null,8,be),e.createElementVNode("p",ye,e.toDisplayString(d.label),1)],12,he))),128))])]),_:1})],4)):e.createCommentVNode("",!0),e.createElementVNode("audio",{ref_key:"audioRef",ref:l,autoplay:r.value.autoplay,loop:r.value.loop,volume:r.value.volume},[e.createElementVNode("source",{src:r.value.src},null,8,ge)],8,ke),h.value?(e.openBlock(),e.createElementBlock("div",Ee,He)):e.createCommentVNode("",!0)])}}});exports.default=Je;
