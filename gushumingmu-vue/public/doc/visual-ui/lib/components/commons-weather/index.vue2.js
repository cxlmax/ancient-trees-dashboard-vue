"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),E=require("axios"),m=require("../../commons/utils/json2css.js"),y=require("../../commons/plugins/event/index.js"),B={key:0,class:"weather-temperature__suffix"},D=e.defineComponent({name:"zv-commons-weather"}),$=e.defineComponent({...D,props:{basicOption:{},useEvents:{}},emits:["on-success","on-error"],setup(d,{emit:f}){const n=d,u=f,w=()=>{const r=e.ref(),s=e.ref({city:"",date:"",week:"",dayweather:"",nightweather:"",daytemp:"",nighttemp:"",daywind:"",nightwind:"",daypower:"",nightpower:"",daytemp_float:"",nighttemp_float:""}),i=e.ref(null),c=t=>{E.get(`https://restapi.amap.com/v3/weather/weatherInfo?city=${t.city}&key=${t.key}&extensions=all`).then(a=>{a.status===200&&a.data.status==="1"&&a.data.forecasts.length>0?(u("on-success",a),y.SHJParseEvent.parseEvents(n.useEvents,"on-success",a),s.value=a.data.forecasts[0].casts[0],s.value.city=a.data.forecasts[0].city):(u("on-error",a),y.SHJParseEvent.parseEvents(n.useEvents,"on-error",a))}).catch(()=>{u("on-error",null),y.SHJParseEvent.parseEvents(n.useEvents,"on-error",null)})},k=t=>(t.fontFamily&&m.autoInstallFont(t.fontFamily),{...m.jsonToCssStyle(t),lineHeight:`${t.lineHeight}px`,transform:`translate(${t.transform.x}px, ${t.transform.y}px)`}),b=(t,a)=>{if(a.find(p=>p.name===s.value.dayweather)){const p=a.find(O=>O.name===s.value.dayweather).url||"";return{mask:`url(${p}) 0px 0px / 100% 100%`,width:`${t.size}px`,height:`${t.size}px`,background:`url(${p}) 0px 0px / 100% 100%, ${t.color}`,backgroundBlendMode:"overlay",marginRight:`${t.margin.right}px`}}return{}},h=t=>{i.value&&clearInterval(i.value),t.autoUpdate!==0?i.value=setInterval(()=>c(t),t.autoUpdate*1e3):(clearInterval(i.value),c(t))};return e.onMounted(()=>{c(n.basicOption),h(n.basicOption)}),e.onBeforeUnmount(()=>{i.value&&clearInterval(i.value)}),{initWeatherMessage:c,rendererDomStyle:k,handleAutoUpdate:h,rendererWeatherTypeStyle:b,weatherRef:r,weather:s}},{handleAutoUpdate:v,rendererDomStyle:l,rendererWeatherTypeStyle:g,weatherRef:S,weather:o}=w();return e.watch(()=>n.basicOption,()=>v(n.basicOption),{deep:!0}),(r,s)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"weatherRef",ref:S,class:"zerov-widgets"},[r.basicOption.icon.show?(e.openBlock(),e.createElementBlock("p",{key:0,class:"weather-icon",style:e.normalizeStyle(e.unref(g)(r.basicOption.icon,r.basicOption.icons))},null,4)):e.createCommentVNode("",!0),r.basicOption.weather.city.show?(e.openBlock(),e.createElementBlock("p",{key:1,class:"weather-city",style:e.normalizeStyle(e.unref(l)(r.basicOption.weather.city.textStyle))},e.toDisplayString(e.unref(o).city),5)):e.createCommentVNode("",!0),r.basicOption.weather.type.show?(e.openBlock(),e.createElementBlock("p",{key:2,class:"weather-type",style:e.normalizeStyle(e.unref(l)(r.basicOption.weather.type.textStyle))},e.toDisplayString(e.unref(o).dayweather),5)):e.createCommentVNode("",!0),r.basicOption.weather.wind.show?(e.openBlock(),e.createElementBlock("p",{key:3,class:"weather-wind",style:e.normalizeStyle(e.unref(l)(r.basicOption.weather.wind.textStyle))},e.toDisplayString(e.unref(o).daywind)+"风"+e.toDisplayString(e.unref(o).daypower)+"级 ",5)):e.createCommentVNode("",!0),r.basicOption.weather.temperature.show?(e.openBlock(),e.createElementBlock("p",{key:4,class:"weather-temperature",style:e.normalizeStyle(e.unref(l)(r.basicOption.weather.temperature.textStyle))},[e.createTextVNode(e.toDisplayString(e.unref(o).nighttemp)+" "+e.toDisplayString(r.basicOption.weather.temperature.connectors)+" "+e.toDisplayString(e.unref(o).daytemp)+" ",1),r.basicOption.weather.temperature.suffix.show?(e.openBlock(),e.createElementBlock("span",B,e.toDisplayString(r.basicOption.weather.temperature.suffix.suffix),1)):e.createCommentVNode("",!0)],4)):e.createCommentVNode("",!0)],512))}});exports.default=$;
