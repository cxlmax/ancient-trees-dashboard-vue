"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),c=require("lodash"),f=require("nanoid"),V=require("vue-virtual-scroller");require("vue-virtual-scroller/dist/vue-virtual-scroller.css");const q=require("../../commons/plugins/datasource/index.js"),d=require("../../commons/plugins/event/index.js"),M=["onClick","onMouseenter","onMouseout"],$=["onClick"],D=t.defineComponent({name:"zv-text-table-basic"}),H=t.defineComponent({...D,props:{basicOption:{},useEvents:{},sources:{},uuid:{}},emits:["on-click-item","on-click-row","on-mouseenter-row","on-mouseout-row"],setup(k,{expose:w,emit:O}){t.useCssVars(e=>({b3073844:e.basicOption.css.table.borderWidth+"px","8b05448c":e.basicOption.css.table.borderStyle,"8ccd2128":e.basicOption.css.table.borderColor,"6e2dd140":e.basicOption.css.table.paddingLeft+"px","337db774":e.basicOption.css.table.alignItems,"175b4ad4":e.basicOption.css.table.justifyContent,"60eba224":e.basicOption.css.header.background,a5715660:e.basicOption.css.header.height+"px","07adbea6":e.basicOption.css.header.color,cc841332:e.basicOption.css.header.fontSize+"px",f6e65ec6:e.basicOption.css.header.fontWeight,"8c7a9228":e.basicOption.css.header.fontStyle,"499661e5":e.basicOption.css.body.height+"px","72b695a2":e.basicOption.css.body.background,"30ed12c2":e.basicOption.css.body.color,"5e7e123c":e.basicOption.css.body.fontSize+"px","2b7438b0":e.basicOption.css.body.fontWeight,28659681:e.basicOption.css.body.fontStyle}));const p=O,b=t.ref(f.nanoid()),l=t.ref([]),i=k,S=()=>{if(!l.value.length)return;const e=Object.keys(l.value[0]),o=i.basicOption.columns||[],s=e.map((n,r)=>{const a=o.find(y=>y.name===n)||{};return{name:a.name||n,label:a.label||n,visible:a.visible!==void 0?a.visible:!0,index:a.index!==void 0?a.index:r,width:a.width||{auto:!0,width:100},font:a.font||{auto:!0,color:"#ffffff",fontSize:12,fontStyle:"normal"}}});i.basicOption.columns=s.sort((n,r)=>n.index-r.index)},v=t.computed(()=>i.basicOption.columns||[]),m=t.computed(()=>v.value.filter(e=>e.visible).map(e=>e.name)),u=()=>{q.SHJDatasourceV2.parse({tId:i.uuid,sources:i.sources,callback:e=>{try{d.SHJParseEvent.parseEvents(i.useEvents,"dataListener",l),b.value=f.nanoid(),l.value=c.cloneDeep(e.data[0].data).map((o,s)=>({id:o.id||s,...o})),S()}catch{d.SHJParseEvent.parseEvents(i.useEvents,"dataListener",null),b.value=f.nanoid(),l.value=[]}}})},h=e=>{const o=v.value.find(s=>s.name===e);return o!=null&&o.width.auto?null:`${o==null?void 0:o.width.width}px`},E=e=>{const o=v.value.find(n=>n.name===e);if(!o)return{};const s={whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"};return{color:o.font.color,fontSize:`${o.font.fontSize}px`,fontStyle:o.font.fontStyle,...s,...o.textStyle}},g=c.debounce((e,o)=>{const s={row:e,rowIndex:o};p("on-click-row",s),d.SHJParseEvent.parseEvents(i.useEvents,"on-click-row",s)},100),C=c.debounce((e,o)=>{const s={row:e,rowIndex:o};p("on-mouseenter-row",s),d.SHJParseEvent.parseEvents(i.useEvents,"on-mouseenter-row",s)},100),z=c.debounce((e,o)=>{const s={row:e,rowIndex:o};p("on-mouseout-row",s),d.SHJParseEvent.parseEvents(i.useEvents,"on-mouseout-row",s)},100),B=c.debounce((e,o,s,n)=>{const r={row:e,item:o,rowIndex:s,columnIndex:n};p("on-click-item",r),d.SHJParseEvent.parseEvents(i.useEvents,"on-click-item",r)},100);return t.watch(()=>c.cloneDeep(i.sources),(e,o)=>{c.isEqual(e,o)||u()},{deep:!0}),t.watch(()=>c.cloneDeep(i.basicOption),(e,o)=>{c.isEqual(e,o)||u()},{deep:!0}),t.onMounted(()=>u()),w({refresh:()=>u(),refreshView:()=>u(),refreshData:()=>u()}),(e,o)=>{const s=t.resolveComponent("el-tooltip");return l.value.length>0?(t.openBlock(),t.createElementBlock("div",{key:b.value,class:"table-scroll"},[e.basicOption.css.header.show?(t.openBlock(),t.createElementBlock("div",{key:0,class:"table-header",style:t.normalizeStyle({"--header-background-image":`url(${e.basicOption.css.header.background})`})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(m.value,n=>(t.openBlock(),t.createElementBlock("div",{key:n,class:"th",style:t.normalizeStyle({width:h(n)})},[t.createElementVNode("p",null,t.toDisplayString(n),1)],4))),128))],4)):t.createCommentVNode("",!0),t.createVNode(t.unref(V.RecycleScroller),{id:"",class:"table-body",items:l.value,"item-size":e.basicOption.css.body.height,"key-field":"id"},{default:t.withCtx(({item:n,index:r})=>[t.createElementVNode("div",{class:"tr",style:t.normalizeStyle({"--row-hover":e.basicOption.css.hoverColor,"--odd-background":e.basicOption.css.oddBackground}),onClick:a=>t.unref(g)(n,r),onMouseenter:a=>t.unref(C)(n,r),onMouseout:a=>t.unref(z)(n,r)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(m.value,a=>(t.openBlock(),t.createElementBlock("div",{key:a,class:"td",style:t.normalizeStyle({width:h(a)}),onClick:y=>t.unref(B)(n,n[a],r,m.value.indexOf(a))},[t.createVNode(s,{content:n[a]},{default:t.withCtx(()=>[t.createElementVNode("p",{style:t.normalizeStyle(E(a))},t.toDisplayString(n[a]),5)]),_:2},1032,["content"])],12,$))),128))],44,M)]),_:1},8,["items","item-size"])])):t.createCommentVNode("",!0)}}});exports.default=H;
