"use strict";var w=Object.defineProperty;var _=(o,e,s)=>e in o?w(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var d=(o,e,s)=>_(o,typeof e!="symbol"?e+"":e,s);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");require("@babylonjs/loaders/glTF");const b=require("lodash"),i=require("@babylonjs/core"),M={class:"zerov-widget"},S=t.defineComponent({name:"zv-commons-vr-photo"}),B=t.defineComponent({...S,props:{basicOption:{}},setup(o){const e=o,s=u=>{const a=t.ref(),v=t.ref();class m{constructor(r,n){d(this,"scene");d(this,"engine");this.canvas=r,this.option=n,this.engine=new i.Engine(this.canvas,!0,{},!1),v.value=!0,window.addEventListener("resize",()=>{this.engine.resize()}),this.scene=this.createScene()}createScene(){const r=new i.Scene(this.engine),n=new i.ArcRotateCamera("Camera",-Math.PI/2,Math.PI/2,5,i.Vector3.Zero(),r);n.attachControl(a.value,!0),n.useAutoRotationBehavior=this.option.cameraAutoRotation,n.inputs.attached.mousewheel.detachControl();const c=new i.PhotoDome("",this.option.url,{resolution:this.option.resolution||32,size:1e3,useDirectMapping:!1},r);if(this.option.isReversal&&(n.angularSensibilityX=-n.angularSensibilityX,n.angularSensibilityY=-n.angularSensibilityY),this.option.imageMode&&(c.imageMode=i.PhotoDome[this.option.imageMode]),c.fovMultiplier=this.option.defaultFov||1,this.option.isScale){let l=c.fovMultiplier;r.onPointerObservable.add(y=>{c!==void 0&&(l+=y.event.wheelDelta*-5e-4,l<0&&(l=0),l>2&&(l=2),c.fovMultiplier=l)},i.PointerEventTypes.POINTERWHEEL)}return setTimeout(()=>{v.value=!1},200),r}run(){return this.engine.runRenderLoop(()=>{this.scene.render()}),this}dispose(){this.scene&&this.engine&&(this.scene.dispose(),this.engine.dispose())}}const h=t.ref();return t.onMounted(()=>{h.value=new m(a.value,u).run()}),t.onBeforeUnmount(()=>{h.value&&h.value.dispose()}),{canvasRef:a,babylon:h,Babylon:m,loadingStatus:v}},{canvasRef:f,babylon:p,Babylon:g}=s(e.basicOption);return t.watch(()=>b.cloneDeep(e.basicOption),(u,a)=>{!b.isEqual(u,a)&&p.value&&(p.value.dispose(),p.value=new g(f.value,e.basicOption).run())},{deep:!0}),(u,a)=>(t.openBlock(),t.createElementBlock("div",M,[t.createElementVNode("canvas",{ref_key:"canvasRef",ref:f,class:"widget"},null,512)]))}});exports.default=B;
