"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),k=require("nanoid"),p=require("lodash"),n=require("../../commons/utils/json2css.js"),R=require("../../commons/utils/clickOutSide.js"),X=require("../../commons/plugins/datasource/index.js"),b=require("../../commons/plugins/event/index.js"),Y={style:{display:"flex","align-items":"center",gap:"4px"}},A={key:1,class:"zerov-widget-select__prefix"},G=["src"],K=["src"],Q=["onClick"],U=["src"],W={class:"zerov-widget-select__option-label"},Z=e.defineComponent({name:"zv-interaction-select"}),C=e.defineComponent({...Z,props:{basicOption:{},sources:{},useEvents:{},uuid:{}},emits:["update:modelValue","on-change"],setup(_,{expose:E,emit:I}){const i=_,$=()=>{const o=e.ref(),c=t=>{if(o.value){n.autoInstallFont(t.fontFamily),n.autoInstallFont(t.hover.fontFamily),n.autoInstallFont(t.focus.fontFamily);const r=e.ref("");return t.boxShadow&&(r.value=`${t.boxShadow.isInset?"inset":""} ${t.boxShadow.offsetX}px ${t.boxShadow.offsetY}px ${t.boxShadow.blur}px ${t.boxShadow.diffus}px ${t.boxShadow.color}`),{...n.jsonToCssStyle(t),...n.jsonToCssStyle(t.hover,"hover"),...n.jsonToCssStyle(t.focus,"focus"),boxShadow:r.value,padding:`${t.padding.map(l=>`${l}px`).join(" ")}`,background:t.isBgImage?`no-repeat center/100% url(${t.backgroundImage})`:t.backgroundColor}}return{}},a=t=>{if(o.value){n.autoInstallFont(t.fontFamily);const r=`${t.boxShadow.isInset?"inset":""} ${t.boxShadow.offsetX}px ${t.boxShadow.offsetY}px ${t.boxShadow.blur}px ${t.boxShadow.diffus}px ${t.boxShadow.color}`;return t.placement==="bottom"?{...n.jsonToCssStyle(t),top:"100%",marginTop:"6px",boxShadow:r,padding:`${t.padding.map(l=>`${l}px`).join(" ")}`}:{...n.jsonToCssStyle(t),bottom:"100%",marginBottom:"6px",boxShadow:r,padding:`${t.padding.map(l=>`${l}px`).join(" ")}`}}},w=t=>{if(o.value)return n.autoInstallFont(t.fontFamily),{padding:`${t.padding.map(r=>`${r}px`).join(" ")}`,...n.jsonToCssStyle(t),...n.jsonToCssStyle(t.hover,"hover"),...n.jsonToCssStyle(t.active,"active")}},H=t=>{if(o.value)return n.autoInstallFont(t.fontFamily),{...n.jsonToCssStyle(t)}},J=t=>{if(o.value)return n.autoInstallFont(t.fontFamily),{...n.jsonToCssStyle(t),...n.jsonToCssStyle(t,"hover"),...n.jsonToCssStyle(t,"focus")}},L=(t,r)=>{const l=r.find(h=>h.type===t);return l?l.url:""},M=(t,r)=>{if(o.value){const l=r.find(h=>h.type===t);if(l)return{...n.jsonToCssStyle(l)}}},y=e.ref(),u=e.ref([]);return{key:y,init:()=>{X.SHJDatasourceV2.parse({tId:i.uuid,sources:i.sources,callback:t=>{try{b.SHJParseEvent.parseEvents(i.useEvents,"dataListener",u),y.value=k.nanoid(),t&&t.data?u.value=p.cloneDeep(t.data[0].data):u.value=[]}catch{b.SHJParseEvent.parseEvents(i.useEvents,"dataListener",null),y.value=k.nanoid(),u.value=[]}}})},options:u,selectRef:o,rendererSelectInput:c,rendererSelectOption:w,rendererSelectDropdown:a,rendererSelectSelected:J,rendererSelectPlaceholder:H,rendererPrefixIcon:L,rendererPrefixIconCss:M}},m=e.ref(""),g=I,s=e.ref(!1),f=e.computed(()=>{const o=x.value.find(c=>c.value===m.value);return o?o.label:""}),O=()=>{s.value=!s.value},S=e.ref(""),z=o=>{m.value=o.value,S.value=o.type,g("update:modelValue",o.value),g("on-change",o),b.SHJParseEvent.parseEvents(i.useEvents,"on-change",{data:o}),s.value=!1},j=()=>{s.value=!1},{key:V,init:d,options:x,selectRef:B,rendererSelectInput:T,rendererSelectOption:F,rendererSelectDropdown:D,rendererSelectSelected:N,rendererSelectPlaceholder:P,rendererPrefixIcon:v,rendererPrefixIconCss:q}=$();return e.onMounted(()=>d()),e.watch(()=>p.cloneDeep(i.basicOption),(o,c)=>{p.isEqual(o,c)||d()},{deep:!0}),e.watch(()=>p.cloneDeep(i.sources),(o,c)=>{p.isEqual(o,c)||d()},{deep:!0}),E({refresh:()=>d(),refreshView:()=>d(),refreshData:()=>d()}),(o,c)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",{key:e.unref(V),ref_key:"selectRef",ref:B,class:e.normalizeClass(["zerov-widget-select",{"is-open":s.value}]),onClick:O},[e.createElementVNode("div",{class:e.normalizeClass(["zerov-widget-select__trigger",{"is-active":s.value}]),style:e.normalizeStyle({...e.unref(T)(o.basicOption.input)})},[e.createElementVNode("div",Y,[f.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:0,class:"zerov-widget-select__placeholder",style:e.normalizeStyle({...e.unref(P)(o.basicOption.input.placeholder)})},e.toDisplayString(o.basicOption.input.placeholder.value),5)),f.value&&e.unref(v)(S.value,o.basicOption.dropdown.option.prefixs)?(e.openBlock(),e.createElementBlock("span",A,[e.createElementVNode("img",{src:e.unref(v)(S.value,o.basicOption.dropdown.option.prefixs),alt:""},null,8,G)])):e.createCommentVNode("",!0),f.value?(e.openBlock(),e.createElementBlock("span",{key:2,class:"zerov-widget-select__selected",style:e.normalizeStyle({...e.unref(N)(o.basicOption.input.selected)})},e.toDisplayString(f.value),5)):e.createCommentVNode("",!0)]),e.createElementVNode("span",{class:e.normalizeClass(["zerov-widget-select__arrow",{"is-open":s.value}])},[e.createElementVNode("img",{src:o.basicOption.input.arrow.url,alt:""},null,8,K)],2)],6),e.createVNode(e.Transition,{name:"fade-in-linear"},{default:e.withCtx(()=>[s.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"zerov-widget-select__dropdown",style:e.normalizeStyle({...e.unref(D)(o.basicOption.dropdown)})},[e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(x),a=>(e.openBlock(),e.createElementBlock("li",{key:a.value,class:e.normalizeClass([{"is-selected":a.value===m.value},"zerov-widget-select__option"]),style:e.normalizeStyle({...e.unref(F)(o.basicOption.dropdown.option)}),onClick:e.withModifiers(w=>z(a),["stop"])},[e.unref(v)(a.type,o.basicOption.dropdown.option.prefixs)?(e.openBlock(),e.createElementBlock("span",{key:0,class:"zerov-widget-select__option-prefix",style:e.normalizeStyle({...e.unref(q)(a.type,o.basicOption.dropdown.option.prefixs)})},[e.createElementVNode("img",{src:e.unref(v)(a.type,o.basicOption.dropdown.option.prefixs),alt:""},null,8,U)],4)):e.createCommentVNode("",!0),e.createElementVNode("span",W,e.toDisplayString(a.label),1)],14,Q))),128))])],4)):e.createCommentVNode("",!0)]),_:1})],2)),[[e.unref(R.default),j]])}});exports.default=C;
