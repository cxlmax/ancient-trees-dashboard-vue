"use strict";var V=Object.create;var b=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var D=(a,e,u,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of A(e))!J.call(a,c)&&c!==u&&b(a,c,{get:()=>e[c],enumerable:!(t=q(e,c))||t.enumerable});return a};var Z=(a,e,u)=>(u=a!=null?V(H(a)):{},D(e||!a||!a.__esModule?b(u,"default",{value:a,enumerable:!0}):u,a));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("vue"),I=require("@vueuse/core"),n=require("lodash"),M=require("is-electron"),j=require("echarts"),k=require("nanoid");require("echarts-wordcloud");require("echarts-liquidfill");const f=require("../plugins/event/index.js"),w=require("../utils/hoverLoop.js");function T(a){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const u in a)if(u!=="default"){const t=Object.getOwnPropertyDescriptor(a,u);Object.defineProperty(e,u,t.get?t:{enumerable:!0,get:()=>a[u]})}}return e.default=a,Object.freeze(e)}const p=T(j),z=a=>{const e=[];a.geo&&(n.isArray(a.geo)?e.push(...a.geo.map(t=>t.map)):e.push(a.geo.map)),a.series&&n.isArray(a.series)&&a.series.forEach(t=>{t.map&&e.push(t.map)});const u=e.map(t=>{if(t==="customize")if(n.isArray(a.geo)){const c=JSON.parse(a.geo.find(d=>d.map==="customize").geoData);return p.registerMap(t,c)}else{const c=JSON.parse(a.geo.geoData);return p.registerMap(t,c)}else return fetch((M()?"gismap/":"/gismap/")+t+".json").then(c=>c.json()).then(c=>{p.registerMap(t,c)}).catch(c=>{})});return Promise.all(u)},x=async a=>{a.bmap&&await import("echarts/extension/bmap/bmap")},B=({basicOption:a,useEvents:e,customRenderData:u,emit:t})=>{const c=k.nanoid(),d=h.ref(!0),l=h.shallowRef(null),m=u,i=h.ref(null),s=h.ref(null),O=(v,y)=>{try{l.value||(l.value=p.init(document.getElementById(c),null,{renderer:y||"svg"}));const r=n.cloneDeep(v);if(r){if(l.value.setOption(r,!0),r.hoverLoop)if(s.value&&clearInterval(s.value),i.value&&i.value.closeSwitchTooltip(),r.hoverLoop.type==="方式二"){let o=0;r.dataset&&r.dataset.source&&(o=r.dataset.source.length),r.series[0]&&r.series[0].data&&(o=r.series[0].data.length);const P=r.dataZoom[0].endValue,L=r.dataZoom[0].startValue,S=()=>{s.value=setInterval(()=>{r.dataZoom[0].endValue>o-2?(r.dataZoom[0].endValue=P,r.dataZoom[0].startValue=L):(r.dataZoom[0].endValue=r.dataZoom[0].endValue+1,r.dataZoom[0].startValue=r.dataZoom[0].startValue+1),l.value.setOption(r)},r.hoverLoop.delay2)};l.value.on("mousemove",function(){s.value&&clearInterval(s.value)}),l.value.on("mouseout",function(){s.value&&clearInterval(s.value),S()}),S()}else r.hoverLoop.type==="方式一"&&(l.value.on("mousemove",function(){i.value&&i.value.closeSwitchTooltip()}),l.value.on("mouseout",function(){i.value&&i.value.closeSwitchTooltip(),i.value=new w.HoverLoop(l.value,r)}),i.value=new w.HoverLoop(l.value,r));else s.value&&clearInterval(s.value),i.value&&i.value.closeSwitchTooltip();l.value.on("click",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-click",o),f.SHJParseEvent.parseEvents(e,"chart-click",o))}),l.value.on("dblclick",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-dblclick",o),f.SHJParseEvent.parseEvents(e,"chart-dblclick",o))}),l.value.on("mousedown",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-mousedown",o),f.SHJParseEvent.parseEvents(e,"chart-mousedown",o))}),l.value.on("mouseup",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-mouseup",o),f.SHJParseEvent.parseEvents(e,"chart-mouseup",o))}),l.value.on("mouseover",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-mouseover",o),f.SHJParseEvent.parseEvents(e,"chart-mouseover",o))}),l.value.on("mouseout",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-mouseout",o),f.SHJParseEvent.parseEvents(e,"chart-mouseout",o))}),l.value.on("contextmenu",o=>{e&&n.isArray(e)&&e.length>0&&(t("chart-contextmenu",o),f.SHJParseEvent.parseEvents(e,"chart-contextmenu",o))}),d.value=!1}}catch{try{l.value.dispose()}catch{}l.value=null}},g=n.debounce(v=>{d.value=!0,v=n.cloneDeep(v),z(v).then(()=>{x(v).then(()=>{m(v)})}).catch(y=>{})},100);return h.onMounted(()=>{g(a),I.useResizeObserver(document.getElementById(c),v=>{l.value&&l.value.resize()})}),h.onBeforeUnmount(()=>{i.value&&i.value.closeSwitchTooltip(),s.value&&clearInterval(s.value);try{l.value&&l.value.dispose()}catch{}}),{id:c,status:d,chart:l,setOption:O,renderChart:g,renderData:m}};exports.useChart=B;
