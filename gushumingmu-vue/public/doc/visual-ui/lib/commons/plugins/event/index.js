"use strict";var f=Object.defineProperty;var y=(s,e,t)=>e in s?f(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var p=(s,e,t)=>y(s,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("lodash"),m=require("./actions/linkAction.js"),g=require("./actions/moveAction.js"),x=require("./actions/sendApiAction.js"),S=require("./actions/scaleAction.js"),b=require("./actions/rotateAction.js"),q=require("./actions/updatePageAction.js"),E=require("./actions/invokeAction.js"),M=require("./actions/fullScreenAction.js"),U=require("./actions/updateVariableAction.js"),V=require("./actions/updateWidgetAction.js"),v=require("./actions/ueCommonsWebscoketAction.js"),k=require("./actions/ueShjExecMethodAction.js"),w=require("./actions/unityWebglExecMethodAction.js"),D=require("./actions/unityIframeExecMethodAction.js"),W=require("./actions/vrSceneMethodAction.js"),d=require("../datasource/utils/utils.js");class A{static addAction(e,t){const n=Array.from(this.actions).find(r=>r.type===e);n&&this.actions.delete(n),this.actions.add({type:e,parser:t})}static getAction(e){const t=Array.from(this.actions).find(n=>n.type===e);return t==null?void 0:t.parser}static parseEvents(e,t,n){e!=null&&e.length&&e.forEach((r,a)=>{r.eventType===t&&setTimeout(()=>{const u=new CustomEvent("event-params-log",{detail:{eventId:r.id,params:n}});window.dispatchEvent(u);const l=this.filterEvent(r,n);if(!this.conditionLogic(r,l)||!r.actions)return;const o=this.getAction(r.actions);o&&o(r,l)},r.delay+a*10)})}static filterEvent(e,t){let n=h.cloneDeep(t);if(e.filterCode)try{const r=d.DataSourceUtils.getVariableData();let a=`
                 ${e.filterCode}
     
                 // 在这里调用 filter 函数，并传递 data 参数
                 return filter(data);
             `;a=a.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),a=d.DataSourceUtils.replaceStringVariables(a,r),n=new Function("data",a)(t)}catch{}return n}static conditionLogic(e,t){var u,l;if(!((l=(u=e.condition)==null?void 0:u.list)!=null&&l.length))return!0;const n=o=>{if(o.type==="field"){if(!o.conditionName)return!1;const c=t[o.conditionName];if(c===void 0)return!1;const i=o.conditionValue;switch(o.conditionExpression){case"eq":return c.toString()===(i||"").toString();case"neq":return c!==i;case"lt":return c<Number(i);case"gt":return c>Number(i);case"lte":return c<=Number(i);case"gte":return c>=Number(i);case"includes":return c.includes(i);case"noincludes":return!c.includes(i);default:return!1}}if(o.type==="custom")try{const c=d.DataSourceUtils.getVariableData();let i=`
                        ${o.customValue}
                        return condition(data);
                    `;return i=i.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),i=d.DataSourceUtils.replaceStringVariables(i,c),new Function("data",i)(t)}catch{return!1}return!1},r=e.condition.list.map(n);return e.condition.type==="and"?r.every(Boolean):r.some(Boolean)}}p(A,"actions",new Set([{type:"link",parser:m.executeLinkAction},{type:"sendApi",parser:x.executeSendApiAction},{type:"move",parser:g.executeMoveAction},{type:"scale",parser:S.executeScaleAction},{type:"rotate",parser:b.executeRotateAction},{type:"updatePage",parser:q.executeUpdatePageAction},{type:"invoke",parser:E.executeInvokeAction},{type:"fullscreen",parser:M.executeFullScreenAction},{type:"updateVariable",parser:U.executeUpdateVariableAction},{type:"updateWidget",parser:V.executeUpdateWidgetAction},{type:"ueCommonsWebscoket",parser:v.executeUeCommonsWebscoketAction},{type:"ueShjExecMethod",parser:k.executeUeShjExecMethodAction},{type:"unityWebglExecMethod",parser:w.executeUnityWebglExecMethodAction},{type:"unityIframeExecMethod",parser:D.executeUnityIframeExecMethodAction},{type:"vrSceneMethod",parser:W.executeVrSceneMethodAction}]));exports.SHJParseEvent=A;
